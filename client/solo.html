<!doctype html>
<html>
	<head>
		<title>WPilot</title>
		<link rel="stylesheet" href="style.css" type="text/css" media="screen" charset="utf-8">
		<script type="text/javascript" src="lib/match.js"></script>
		<!--script type="text/javascript" src="lib/swfobject.js"></script>
	  <script type="text/javascript" src="lib/FABridge.js"></script>
		<script type="text/javascript" src="lib/web_socket.js"></script-->
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
		<script type="text/javascript" src="lib/particle.js"></script>
		<script type="text/javascript" src="devices.js"></script>
		<script type="text/javascript" src="gameobjects.js"></script>
		<script type="text/javascript" src="wpilot.js"></script>
		<script>
			var wpilot = null;

			$(document).ready(function() {
				
			  var options = $.extend({}, DEFAULT_OPTIONS);
			  var canvas = $('#viewport canvas');

			  var viewport  = new ViewportDevice(canvas[0], canvas.width(), canvas.height(), options),
			      keyboard  = new KeyboardDevice(document, options),
						sound			= new SoundDevice(options);
				
			  wpilot = new WPilotClient(options);
			  wpilot.set_viewport(viewport)
			  wpilot.set_input(keyboard);
			  wpilot.set_sound(sound);
        // OP_WORLD_DATA
        var world = new World(true) // true so I manage collisions etc
        var map_data = {
        	name: 'Battle Royale',
        	author: 'Johan Dahlberg',
        	recommended_players: 8,

        	data: [
        		[51,  0,  0, 51,  0,  0, 51],
        		[ 0, 11, 11,  0, 11, 11,  0],
        		[ 0, 11, 52,  0, 52, 11,  0],
        		[51,  0,  0, 12,  0,  0, 51],
        		[ 0, 11, 52,  0, 52, 11,  0],
        		[ 0, 11, 11,  0, 11, 11,  0],
        		[51,  0,  0, 51,  0,  0, 51]
        	]
        }
        var my_rules = {respawn_time:       400,
        reload_time:        15,
        shoot_cost:         300,
        shield_cost:        30,
        energy_recovery:    30,
        round_limit:        10,
        suicide_penelty:    1,
        kill_score:         1,
        powerup_max:        2,
        powerup_respawn:    600,
        powerup_spread_t:   700,
        powerup_rapid_t:    600,
        powerup_rico_t:     600}
        

        world.build(map_data, my_rules)

        world.build(map_data, my_rules)
        wpilot.log('World data loaded...')
        wpilot.set_world(world)
        // OP_WORLD_STATE
        var my_id = 1
        var my_name = 'claudio'
        var player = new Player({ id: my_id, name: my_name});
        var players = [player]
        wpilot.world.players = players
        var powerups = []
        var state = {max_players: 2, no_players: 1, rules: my_rules}
        wpilot.world.set_state(state, players, powerups);
        wpilot.set_player(wpilot.world.players[my_id]);
        wpilot.start_gameloop(wpilot.world.tick);
        // OP_PLAYER_INFO
        wpilot.world.update_player_info(my_id, 100, true, my_name)
        // wpilot.world.update_player_state(my_id, wpilot.player.entity.pos, wpilot.player.entity.angle, wpilot.player.entity.action)
        
        // World.prototype.update_state
        wpilot.world.spawn_player(my_id);


			});
		</script>
		
	</head>
	<body>
		<section id="viewport" class="mode540">
			<canvas></canvas>
		</section>
		<section id="splash" class="dialog">
			<h1 class='logo'>WPilot</h1>
			<section class="notice">
				Contacting server, please wait...
			</section>
			<section class="server-info">
				<h2></h2>
				<p class="ping">C</p> 
				<p class="map">C</p> 
				<p class="players"></p> 
				<div class="actions">
					<button>Join server</button> <span> or <a href="#">Refresh</a></span>
				</div>
			</section>
			<p class="version"></p>
		</section>
		<section id="options" class="dialog">
			<h1 class='logo'>WPilot</h1>
			<section>
				<h2></h2>
				<form>
					<p>Welcome to WPilot. Set options below, then click continue.</p>
					<label for="name">Player name</label> 
					<input name="name" type="text">
					<label for="bg-sound">Enable background sound</label> 
					<input type="checkbox" name="bg-sound" checked>
					<label for="fg-sound">Enable SFX sounds</label> 
					<input type="checkbox" name="fg-sound" checked>
				</form>
				<div class="actions">
					<button>Continue</button>
				</div>
			</section>
			<p class="version"></p>
		</section>
	</body>
</html>
